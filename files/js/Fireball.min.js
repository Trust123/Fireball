$.widget("ui.fireSlide",{_buttonList:null,_count:0,_index:0,_items:null,_itemContainer:null,_timer:null,options:{speed:2000},_width:0,_create:function(){var b=this.element.children("div");this._itemContainer=$("<div />").appendTo(this.element).css("left",0);b.appendTo(this._itemContainer);this._items=this._itemContainer.children("div");this._count=this._items.length;this._index=0;var c=0;this._width=this.element.innerWidth();this._items.each($.proxy(function(e,f){$(f).css({left:(e*(40+this._width)),width:this._width}).show()},this));this._buttonList=$('<ul class="slideshowButtonList" />').appendTo(this.element);for(var d=0;d<this._count;d++){if($(this._items.get(d)).outerHeight()>=c){c=$(this._items.get(d)).outerHeight()+7}var a=$('<li><a><span class="icon icon16 fa-circle"></span></a></li>').click($.proxy(this._click,this)).appendTo(this._buttonList);if(d==0){a.addClass("active")}}this.element.css("height",c);$(window).resize($.proxy(this._resize,this));this._restartTimer()},_click:function(a){a.preventDefault();this.slideTo($(a.currentTarget).index());this._restartTimer()},_resize:function(){var a=0;for(var b=0;b<this._count;b++){if($(this._items.get(b)).outerHeight()>=a){a=$(this._items.get(b)).outerHeight()}}this.element.css("height",a);this._width=this.element.innerWidth();this._items.each($.proxy(function(c,d){$(d).css({left:(c*(40+this._width)),width:this._width})},this));this._index=0;this.slideTo()},_restartTimer:function(){if(this._timer!==null){window.clearInterval(this._timer)}this._timer=window.setInterval($.proxy(this.slideTo,this),this.options.speed)},slideTo:function(a){if(typeof a!=="undefined"){this._index=a}else{this._index=this._index+1}if(this._index==this._count){this._index=0}this._buttonList.find(".active").removeClass("active");$(this._buttonList.children().get(this._index)).addClass("active");this._itemContainer.css({left:(this._index*(40+this._width)*-1)})}});if(!Fireball){var Fireball={}}Fireball.Page={};Fireball.Page.Add=Class.extend({_pageID:0,_cache:{},_dialog:null,init:function(a){this._pageID=a;$("#pageAddButton").click($.proxy(this._click,this))},_click:function(a){a.preventDefault();this._proxy=new WCF.Action.Proxy({success:$.proxy(this._success,this)});this._proxy.setOption("data",{actionName:"getAddDialog",className:"cms\\data\\page\\PageAction",objectIDs:[this._pageID]});this._proxy.sendRequest()},_show:function(a){this._dialog=$('<div id="pageAddDialog">'+this._cache[a]+"</div>").appendTo(document.body);this._dialog.wcfDialog({title:WCF.Language.get("cms.page.add")});this._dialog.find("input[type=submit]").click($.proxy(this._submit,this))},_submit:function(a){a.preventDefault();parameters={};$("#pageAddForm input, #pageAddForm textarea, #pageAddForm select").each(function(c){var b=$(this);if(b.attr("type")!="checkbox"){parameters[b.attr("name")]=$.trim(b.val())}else{parameters[b.attr("name")]=b.prop("checked")?1:0}});this._proxy=new WCF.Action.Proxy({success:$.proxy(this._executed,this)});this._proxy.setOption("data",{actionName:"frontendCreate",className:"cms\\data\\page\\PageAction",objectIDs:[this._pageID],parameters:{data:parameters}});this._proxy.sendRequest()},_executed:function(b,d,a){if(typeof this._cache[b.returnValues.errors]==="undefined"){var c=new WCF.System.Notification(WCF.Language.get("wcf.global.success"));c.show(function(){window.location=b.returnValues.link})}},_success:function(b,c,a){this._cache[b.returnValues.pageID]=b.returnValues.template;this._show(b.returnValues.pageID)}});Fireball.Page.ContentTypes=Class.extend({_pageID:0,_proxy:null,_setDraggable:false,init:function(a){this._pageID=a;this._proxy=new WCF.Action.Proxy({success:$.proxy(this._success,this)});this._proxy.setOption("data",{actionName:"getContentTypes",className:"cms\\data\\page\\PageAction",objectIDs:[this._pageID],parameters:{position:"both"}});this._proxy.sendRequest()},setSet:function(){this._setDraggable=true},_success:function(b,c,a){$("body").append(b.returnValues.template);$("body").append($('<a id="contentTypeListOpen" class="button buttonPrimary"><span class="icon icon32 fa-angle-right"></span></a>'));$("#contentTypeListOpen").click($.proxy(this._toggleSidebar,this));$("#contentTypeListClose").click($.proxy(this._toggleSidebar,this))},_toggleSidebar:function(){if(!$("#contentTypeList").hasClass("open")){$("#contentTypeList").addClass("open")}else{this._closeSidebar()}},_closeSidebar:function(){if($("#contentTypeList").hasClass("open")){$("#contentTypeList").removeClass("open")}}});Fireball.Page.InlineEditor=WCF.InlineEditor.extend({_pageID:0,_environment:"page",_permissions:{},_redirectURL:"",_updateHandler:null,_editStarted:false,_contentTypeOverlay:null,_dragging:null,_proxy:null,_setOptions:function(){this._environment="page";this._options=[{label:WCF.Language.get("cms.page.edit.start"),optionName:"start"},{label:WCF.Language.get("cms.page.edit.addContent"),optionName:"addContent"},{label:WCF.Language.get("cms.page.edit.save"),optionName:"save"},{optionName:"divider"},{label:WCF.Language.get("cms.page.edit.finish"),optionName:"finish"},{label:WCF.Language.get("cms.page.edit.acp"),optionName:"acp",isQuickOption:true}]},setUpdateHandler:function(a){this._updateHandler=a},_getTriggerElement:function(a){return a.find(".jsPageInlineEditor")},_validate:function(a,b){switch(b){case"addContent":return this._editStarted;break;case"start":return !this._editStarted;break;case"save":return this._editStarted;break;case"finish":return this._editStarted;break;case"acp":return true;break}return false},_execute:function(a,c){if(!this._validate(a,c)){return false}switch(c){case"start":if(this._editStarted){return}var b=this;this._contentTypeOverlay=new Fireball.Page.ContentTypes(this._pageID);this._dragging=new Fireball.Content.Dragging(this._pageID);this._editStarted=true;break;case"addContent":this._contentTypeOverlay._toggleSidebar();if(!this._contentTypeOverlay._setDraggable){$(".draggable").draggable({cursor:"move",helper:"clone",revert:"invalid",containment:"document",drag:$.proxy(this._dragging._drag,this._dragging)})}break;case"save":this._dragging.getSortableListObject("body")._submit();this._dragging.getSortableListObject("sidebar")._submit();break;case"finish":var b=this;WCF.System.Confirmation.show(WCF.Language.get("cms.page.edit.finish.confirm"),function(d){if(d==="confirm"){b._contentTypeOverlay._closeSidebar();this._proxy=new WCF.Action.Proxy({success:$.proxy(b._loadParsedContents,b)});this._proxy.setOption("data",{actionName:"getParsedContentList",className:"cms\\data\\page\\PageAction",objectIDs:[b._pageID],parameters:{position:"body"}});this._proxy.sendRequest();this._proxy.setOption("data",{actionName:"getParsedContentList",className:"cms\\data\\page\\PageAction",objectIDs:[b._pageID],parameters:{position:"sidebar"}});this._proxy.sendRequest();b._editStarted=false}});break;case"acp":window.location=$("#"+a).data("advancedUrl");break}},_loadParsedContents:function(b,c,a){position=b.returnValues.position;$('.ui-droppable[data-position="'+position+'"]').remove();$("#sortableContentList"+position.charAt(0).toUpperCase()+position.slice(1)).remove();if(b.returnValues.position=="body"){$(b.returnValues.template).insertAfter($(".content .contentHeader"))}else{if(b.returnValues.position=="sidebar"){$("aside.sidebar").append(b.returnValues.template)}else{if(b.returnValues.position=="sidebarLeft"){$("aside.boxesSidebarLeft").append(b.returnValues.template)}else{if(b.returnValues.position=="sidebarRight"){$("aside.boxesSidebarRight").append(b.returnValues.template)}}}}},_updatePage:function(a,d,e){var b=this;var c=this._elements[a].data("pageID");this._updateData.push({data:e,elementID:a,optionName:d});this._proxy.setOption("data",{actionName:d,className:"cms\\data\\page\\PageAction",objectIDs:[this._elements[a].data("pageID")],parameters:{data:e},success:function(f){b._updateHandler.update(c,f.returnValues.pageData[c])}});this._proxy.sendRequest()},_getPermission:function(a){if(this._permissions[a]){return this._permissions[a]}return 0},setEnvironment:function(a,b,c){if(a!=="page"){a="page"}this._environment=a;this._pageID=b;this._redirectURL=c},setPermission:function(a,b){this._permissions[a]=b},setPermissions:function(a){for(var b in a){this.setPermission(b,a[b])}}});Fireball.Page.UpdateHandler=Class.extend({});Fireball.Content={};Fireball.Content.AddForm=Class.extend({_pageID:0,_cache:{},_dialog:null,init:function(b,a,c,d){this._pageID=b;this._proxy=new WCF.Action.Proxy({success:$.proxy(this._success,this)});this._proxy.setOption("data",{actionName:"getAddDialog",className:"cms\\data\\content\\ContentAction",objectIDs:[],parameters:{position:a,type:c,parentID:d,pageID:this._pageID}});this._proxy.sendRequest()},_show:function(a){this._dialog=$('<div id="contentAddDialog">'+this._cache[a]+"</div>").appendTo(document.body);this._dialog.wcfDialog({title:WCF.Language.get("cms.content.add")});this._dialog.find("input[type=submit]").click($.proxy(this._submit,this))},_executed:function(b,d,a){if(typeof b.returnValues.errors==="undefined"){this._dialog.wcfDialog("close");var c=new WCF.System.Notification(WCF.Language.get("wcf.global.success"));c.show(function(){window.location=location})}},_submit:function(a){a.preventDefault();parameters={};parameters.contentData={};parameters.contentData["columnData"]=[];$("#contentAddForm input, #contentAddForm textarea, #contentAddForm select").each(function(c){var b=$(this);if(b.attr("type")!="checkbox"){parameters[b.attr("name")]=$.trim(b.val())}else{parameters[b.attr("name")]=b.prop("checked")?1:0}if(typeof b.attr("name")!=="undefined"&&b.attr("name").match("^contentData")){delete parameters[b.attr("name")];if(b.attr("name").match("columnData")){parameters.contentData["columnData"].push($.trim(b.val()))}else{parameters.contentData[b.attr("id")]=$.trim(b.val())}if(typeof parameters.contentData["columnData"]!=="undefined"&&parameters.contentData["columnData"].length==0){delete parameters.contentData["columnData"]}}});this._proxy=new WCF.Action.Proxy({success:$.proxy(this._executed,this)});this._proxy.setOption("data",{actionName:"frontendCreate",className:"cms\\data\\content\\ContentAction",objectIDs:[],parameters:{data:parameters}});this._proxy.sendRequest()},_success:function(b,c,a){this._cache[this._pageID]=b.returnValues.template;this._show(this._pageID)}});Fireball.Content.Dragging=Class.extend({_sortableList:{},_proxy:null,_pageID:0,init:function(a){this._pageID=a;$("div[id^='cmsContent']").each(function(){$(this).remove()});$("section[id^='cmsContent']").each(function(){$(this).remove()});this._proxy=new WCF.Action.Proxy({success:$.proxy(this._success,this)});this._proxy.setOption("data",{actionName:"getSortableContentList",className:"cms\\data\\page\\PageAction",objectIDs:[this._pageID],parameters:{position:"body"}});this._proxy.sendRequest();this._proxy.setOption("data",{actionName:"getSortableContentList",className:"cms\\data\\page\\PageAction",objectIDs:[this._pageID],parameters:{position:"sidebar"}});this._proxy.sendRequest()},_drag:function(a,b){b.helper.css("position","fixed");b.helper.css("margin-top",a.pageY);b.helper.css("margin-left",a.pageX);b.position.top=0;b.position.left=0},_drop:function(c,e){if(typeof e.draggable.attr("id")!=="undefined"&&e.draggable.attr("id").match("^de.codequake.cms")){$(c.target).append('<div class="draggedContent '+e.draggable.attr("id")+'" />');var b=e.draggable.attr("id");var a="body";if(typeof $(c.target).data("position")!=="undefined"){a=$(c.target).data("position")}if(typeof $(c.target).attr("id")!=="undefined"&&$(c.target).attr("id").match("^cmsContent")){var d=$(c.target).attr("id").replace("cmsContent","")}var f=0;if(typeof d!=="undefined"){f=d}new Fireball.Content.AddForm(this._pageID,a,b,f)}},_success:function(b,c,a){template=b.returnValues.template;if(b.returnValues.position=="body"){$(template).insertAfter($(".content .contentHeader"))}else{if(b.returnValues.position=="sidebar"){$("aside.sidebar").append(template)}else{if(b.returnValues.position=="sidebarLeft"){$("aside.boxesSidebarLeft").append(template)}else{if(b.returnValues.position=="sidebarRight"){$("aside.boxesSidebarRight").append(template)}}}}$container=$("#sortableContentList"+b.returnValues.position.charAt(0).toUpperCase()+b.returnValues.position.slice(1));this._sortableList[b.returnValues.position]=new Fireball.Content.Sortable.List("sortableContentList"+b.returnValues.position.charAt(0).toUpperCase()+b.returnValues.position.slice(1));if($container!==undefined){$container.parent().find(".ui-droppable").droppable({activeClass:"droppable-state-active",greedy:true,drop:$.proxy(this._drop,this)})}},getSortableListObject:function(a){return this._sortableList[a]}});Fireball.Content.Sortable={};Fireball.Content.Sortable.List=WCF.Sortable.List.extend({init:function(a){this._super(a);this._className="cms\\data\\content\\ContentAction"},_submit:function(){this._structure={};this._container.find(".sortableList").each($.proxy(function(c,e){var b=$(e);var d=b.data("objectID");if(d!==undefined){b.children(this._options.items).each($.proxy(function(f,h){var g=$(h).data("objectID");if(!this._structure[d]){this._structure[d]=[]}this._structure[d].push(g)},this))}},this));if(Object.keys(this._structure).length===0){return}var a=$.extend(true,{data:{offset:this._offset,structure:this._structure}},this._additionalParameters);this._proxy.setOption("data",{actionName:"updatePosition",className:this._className,interfaceName:"wcf\\data\\ISortableAction",parameters:a});this._proxy.sendRequest()}});