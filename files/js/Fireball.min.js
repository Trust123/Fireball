$.widget("ui.fireSlide",{_buttonList:null,_count:0,_index:0,_items:null,_itemContainer:null,_timer:null,options:{speed:2000},_width:0,_create:function(){var b=this.element.children("div");this._itemContainer=$("<div />").appendTo(this.element).css("left",0);b.appendTo(this._itemContainer);this._items=this._itemContainer.children("div");this._count=this._items.length;this._index=0;var c=0;this._width=this.element.innerWidth();this._items.each($.proxy(function(e,f){$(f).css({left:(e*(40+this._width)),width:this._width}).show()},this));this._buttonList=$('<ul class="slideshowButtonList" />').appendTo(this.element);for(var d=0;d<this._count;d++){if($(this._items.get(d)).outerHeight()>=c){c=$(this._items.get(d)).outerHeight()+7}var a=$('<li><a><span class="icon icon16 fa-circle"></span></a></li>').click($.proxy(this._click,this)).appendTo(this._buttonList);if(d==0){a.addClass("active")}}this.element.css("height",c);$(window).resize($.proxy(this._resize,this));this._restartTimer()},_click:function(a){a.preventDefault();this.slideTo($(a.currentTarget).index());this._restartTimer()},_resize:function(){var a=0;for(var b=0;b<this._count;b++){if($(this._items.get(b)).outerHeight()>=a){a=$(this._items.get(b)).outerHeight()}}this.element.css("height",a);this._width=this.element.innerWidth();this._items.each($.proxy(function(c,d){$(d).css({left:(c*(40+this._width)),width:this._width})},this));this._index=0;this.slideTo()},_restartTimer:function(){if(this._timer!==null){window.clearInterval(this._timer)}this._timer=window.setInterval($.proxy(this.slideTo,this),this.options.speed)},slideTo:function(a){if(typeof a!=="undefined"){this._index=a}else{this._index=this._index+1}if(this._index==this._count){this._index=0}this._buttonList.find(".active").removeClass("active");$(this._buttonList.children().get(this._index)).addClass("active");this._itemContainer.css({left:(this._index*(40+this._width)*-1)})}});if(!Fireball){var Fireball={}}Fireball.Page={};Fireball.Page.Add=Class.extend({_pageID:0,_cache:{},_dialog:null,init:function(a){this._pageID=a;$("#pageAddButton").click($.proxy(this._click,this))},_click:function(a){a.preventDefault();this._proxy=new WCF.Action.Proxy({success:$.proxy(this._success,this)});this._proxy.setOption("data",{actionName:"getAddDialog",className:"cms\\data\\page\\PageAction",objectIDs:[this._pageID]});this._proxy.sendRequest()},_show:function(a){this._dialog=$('<div id="pageAddDialog">'+this._cache[a]+"</div>").appendTo(document.body);this._dialog.wcfDialog({title:WCF.Language.get("cms.page.add")});this._dialog.find("input[type=submit]").click($.proxy(this._submit,this))},_submit:function(b){b.preventDefault();var a={};$('#pageAddForm input:not([type="submit"]), #pageAddForm textarea, #pageAddForm select').each(function(d){var c=$(this);if(c.attr("type")!="checkbox"){a[c.attr("name")]=$.trim(c.val())}else{a[c.attr("name")]=c.prop("checked")?1:0}});this._proxy=new WCF.Action.Proxy({success:$.proxy(this._executed,this)});this._proxy.setOption("data",{actionName:"frontendCreate",className:"cms\\data\\page\\PageAction",objectIDs:[this._pageID],parameters:{data:a}});this._proxy.sendRequest()},_executed:function(b,d,a){if(typeof this._cache[b.returnValues.errors]==="undefined"){var c=new WCF.System.Notification(WCF.Language.get("wcf.global.success"));c.show()}},_success:function(b,c,a){this._cache[b.returnValues.pageID]=b.returnValues.template;this._show(b.returnValues.pageID)}});Fireball.Page.ContentTypes=Class.extend({_pageID:0,_proxy:null,_setDraggable:false,init:function(a){this._pageID=a;this._proxy=new WCF.Action.Proxy({success:$.proxy(this._success,this)});this._proxy.setOption("data",{actionName:"getContentTypes",className:"cms\\data\\page\\PageAction",objectIDs:[this._pageID],parameters:{position:"both"}});this._proxy.sendRequest()},setSet:function(){this._setDraggable=true},_success:function(b,c,a){$("body").append(b.returnValues.template);$("#contentTypeListToggle").click($.proxy(this._toggleSidebar,this))},_toggleSidebar:function(){if(!$("#contentTypeList").hasClass("open")){$("#contentTypeList").addClass("open")}else{this._closeSidebar()}},_closeSidebar:function(){if($("#contentTypeList").hasClass("open")){$("#contentTypeList").removeClass("open")}}});Fireball.Page.ContentEditor=Class.extend({_editStarted:false,_contentTypeOverlay:null,_dragging:null,_proxy:null,init:function(){if(this._editStarted){return}this._contentTypeOverlay=new Fireball.Page.ContentTypes(this._pageID);this._dragging=new Fireball.Content.Dragging(this._pageID);this._editStarted=true}});Fireball.Page.InlineEditor=WCF.InlineEditor.extend({_pageID:0,_environment:"page",_permissions:{},_redirectURL:"",_updateHandler:null,_editStarted:false,_contentTypeOverlay:null,_dragging:null,_proxy:null,_forcedEditor:false,_setOptions:function(){this._environment="page";this._options=[{label:WCF.Language.get("cms.page.edit.start"),optionName:"start"},{label:WCF.Language.get("cms.page.edit.addContent"),optionName:"addContent"},{label:WCF.Language.get("cms.page.edit.save"),optionName:"save"},{optionName:"divider"},{label:WCF.Language.get("cms.page.edit.finish"),optionName:"finish"},{label:WCF.Language.get("cms.page.edit.acp"),optionName:"acp",isQuickOption:true}]},setUpdateHandler:function(a){this._updateHandler=a},_getTriggerElement:function(a){return a.find(".jsPageInlineEditor")},_setForced:function(){this._forcedEditor=true},_validate:function(a,b){switch(b){case"addContent":return this._editStarted;break;case"initEdit":case"start":return !this._editStarted;break;case"save":return this._editStarted;break;case"finish":return this._editStarted;break;case"acp":return true;break}return false},_execute:function(b,d){if(!this._validate(b,d)){return false}switch(d){case"start":if(this._editStarted){return}window.location=$("#"+b).data("editorUrl");this._editStarted=true;break;case"initEdit":if(this._editStarted){return}this._contentTypeOverlay=new Fireball.Page.ContentTypes(this._pageID);this._dragging=new Fireball.Content.Dragging(this._pageID,this._forcedEditor);this._editStarted=true;break;case"addContent":this._contentTypeOverlay._toggleSidebar();if(!this._contentTypeOverlay._setDraggable){$(".draggable").draggable({cursor:"move",helper:"clone",revert:"invalid",containment:"document",drag:$.proxy(this._dragging._drag,this._dragging)})}break;case"save":var a=["hero","headerBoxes","top","sidebarLeft","body","sidebarRight","bottom","footerBoxes","footer"];var c=this;a.forEach(function(f,e){if(c._dragging.getSortableListObject(f)){c._dragging.getSortableListObject(f)._submit()}});break;case"finish":var c=this;WCF.System.Confirmation.show(WCF.Language.get("cms.page.edit.finish.confirm"),function(e){if(e==="confirm"){c._contentTypeOverlay._closeSidebar();c._execute(b,"save");c._editStarted=false;window.location=$("#"+b).data("url")}});break;case"acp":window.location=$("#"+b).data("advancedUrl");break}},_loadParsedContents:function(c,d,b){var a=c.returnValues.position;$('.ui-droppable[data-position="'+a+'"]').remove();$("#sortableContentList"+a.charAt(0).toUpperCase()+a.slice(1)).remove();if(c.returnValues.position=="body"){$(c.returnValues.template).insertAfter($(".content .contentHeader"))}else{if(c.returnValues.position=="sidebar"){$("aside.sidebar").append(c.returnValues.template)}else{if(c.returnValues.position=="sidebarLeft"){$("aside.boxesSidebarLeft").append(c.returnValues.template)}else{if(c.returnValues.position=="sidebarRight"){$("aside.boxesSidebarRight").append(c.returnValues.template)}}}}},_updatePage:function(a,d,e){var b=this;var c=this._elements[a].data("pageID");this._updateData.push({data:e,elementID:a,optionName:d});this._proxy.setOption("data",{actionName:d,className:"cms\\data\\page\\PageAction",objectIDs:[this._elements[a].data("pageID")],parameters:{data:e},success:function(f){b._updateHandler.update(c,f.returnValues.pageData[c])}});this._proxy.sendRequest()},_getPermission:function(a){if(this._permissions[a]){return this._permissions[a]}return 0},setEnvironment:function(a,b,c){if(a!=="page"){a="page"}this._environment=a;this._pageID=b;this._redirectURL=c},setPermission:function(a,b){this._permissions[a]=b},setPermissions:function(a){for(var b in a){this.setPermission(b,a[b])}}});Fireball.Page.UpdateHandler=Class.extend({});Fireball.Content={};Fireball.Content.Dragging=Class.extend({_sortableList:{},_proxy:null,_dialog:null,_pageID:0,_forcedEditor:false,_cache:{},_i18nFields:{},init:function(b,d){this._pageID=b;this._forcedEditor=d;if(!this._forcedEditor){$("div[id^='cmsContent']").each(function(){$(this).remove()});$("section[id^='cmsContent']").each(function(){$(this).remove()});this._proxy=new WCF.Action.Proxy({success:$.proxy(this._success,this)});this._proxy.setOption("data",{actionName:"getSortableContentList",className:"cms\\data\\page\\PageAction",objectIDs:[this._pageID],parameters:{position:"body"}});this._proxy.sendRequest();this._proxy.setOption("data",{actionName:"getSortableContentList",className:"cms\\data\\page\\PageAction",objectIDs:[this._pageID],parameters:{position:"sidebar"}});this._proxy.sendRequest()}else{var a=["hero","headerBoxes","top","sidebarLeft","body","sidebarRight","bottom","footerBoxes","footer"];var c=this;a.forEach(function(g,f){var e=$("#sortableContentList"+g.charAt(0).toUpperCase()+g.slice(1));c._sortableList[g]=new Fireball.Content.Sortable.List("sortableContentList"+g.charAt(0).toUpperCase()+g.slice(1));if(e!==undefined){e.parent().find(".ui-droppable").droppable({activeClass:"droppable-state-active",greedy:true,drop:$.proxy(c._drop,c)})}})}},_drag:function(a,b){b.helper.css("position","fixed");b.helper.css("margin-top",a.pageY);b.helper.css("margin-left",a.pageX);b.position.top=0;b.position.left=0},_drop:function(c,e){if(typeof e.draggable.attr("id")!=="undefined"&&e.draggable.attr("id").match("^de.codequake.cms")){$(c.target).append('<div class="draggedContent '+e.draggable.attr("id")+'" />');var b=e.draggable.attr("id");var a="body";if(typeof $(c.target).data("position")!=="undefined"){a=$(c.target).data("position")}if(typeof $(c.target).attr("id")!=="undefined"&&$(c.target).attr("id").match("^cmsContent")){var d=$(c.target).attr("id").replace("cmsContent","")}var f=0;if(typeof d!=="undefined"){f=d}this._addDialogInit(a,b,f)}},_addDialogInit:function(a,b,c){this._proxy=new WCF.Action.Proxy({success:$.proxy(this._addDialogSuccess,this)});this._proxy.setOption("data",{actionName:"getAddDialog",className:"cms\\data\\content\\ContentAction",objectIDs:[],parameters:{position:a,type:b,parentID:c,pageID:this._pageID}});this._proxy.sendRequest()},_addDialogSuccess:function(b,c,a){this._cache[this._pageID]=b.returnValues.template;this._dialog=$('<div id="contentAddDialog">'+this._cache[this._pageID]+"</div>").appendTo(document.body);this._dialog.wcfDialog({title:WCF.Language.get("cms.content.add")});if(b.returnValues.i18nFields){this._i18nFields=b.returnValues.i18nFields}else{this._i18nFields={}}this._dialog.find("input[type=submit]").click($.proxy(this._addDialogSubmit,this))},_addDialogSubmit:function(c){c.preventDefault();var b={};var a={};b.contentData={};b.contentData["columnData"]=[];$("#contentAddForm .dataPart input, #contentAddForm .dataPart textarea, #contentAddForm .dataPart select").each(function(e){var d=$(this);if(d.attr("type")!="checkbox"){b[d.attr("name")]=$.trim(d.val())}else{b[d.attr("name")]=d.prop("checked")?1:0}if(typeof d.attr("name")!=="undefined"&&d.attr("name").match("^contentData")){delete b[d.attr("name")];if(d.attr("name").match("columnData")){b.contentData["columnData"].push($.trim(d.val()))}else{b.contentData[d.attr("id")]=$.trim(d.val())}if(typeof b.contentData["columnData"]!=="undefined"&&b.contentData["columnData"].length==0){delete b.contentData["columnData"]}}});b.pageID=this._pageID;b.position=$('#contentAddForm .formSubmit input[name="position"]').val();b.parentID=$('#contentAddForm .formSubmit input[name="parentID"]').val();this._i18nFields.forEach(function(e,d){console.log("should read i18nValues for "+e)});this._proxy=new WCF.Action.Proxy({success:$.proxy(this._addDialogExecuted,this)});this._proxy.setOption("data",{actionName:"frontendCreate",className:"cms\\data\\content\\ContentAction",objectIDs:[],parameters:{data:b,objectType:$('#contentAddForm .formSubmit input[name="objectType"]').val(),i18nValues:a}});this._proxy.sendRequest()},_addDialogExecuted:function(d,f,c){if(typeof d.returnValues.errors==="undefined"){this._dialog.wcfDialog("close");var e=new WCF.System.Notification(WCF.Language.get("wcf.global.success"));var b=this;var a=d.returnValues.position;e.show();if(b.getSortableListObject(a)){b.getSortableListObject(a)._submit()}this._proxy=new WCF.Action.Proxy({success:$.proxy(this._success,this)});this._proxy.setOption("data",{actionName:"getSortableContentList",className:"cms\\data\\page\\PageAction",objectIDs:[this._pageID],parameters:{position:a}});this._proxy.sendRequest()}},_success:function(e,f,d){var a="sortableContentList"+e.returnValues.position.charAt(0).toUpperCase()+e.returnValues.position.slice(1);var c=$("#"+a).parent();$("#"+a).remove();$('div.ui-droppable[data-position="'+e.returnValues.position+'"]').remove();c.append(e.returnValues.template);var b=$("#"+a);this._sortableList[e.returnValues.position]=new Fireball.Content.Sortable.List(a);if(b!==undefined){b.parent().find(".ui-droppable").droppable({activeClass:"droppable-state-active",greedy:true,drop:$.proxy(this._drop,this)})}},getSortableListObject:function(a){return this._sortableList[a]}});Fireball.Content.Sortable={};Fireball.Content.Sortable.List=WCF.Sortable.List.extend({init:function(a){this._super(a,"cms\\data\\content\\ContentAction")},_submit:function(){this._structure={};this._container.find(".sortableList").each($.proxy(function(c,e){var b=$(e);var d=b.data("objectID");if(d!==undefined){b.children(this._options.items).each($.proxy(function(f,h){var g=$(h).data("objectID");if(!this._structure[d]){this._structure[d]=[]}this._structure[d].push(g)},this))}},this));if(Object.keys(this._structure).length===0){return}var a=$.extend(true,{data:{offset:this._offset,structure:this._structure}},this._additionalParameters);this._proxy.setOption("data",{actionName:"updatePosition",className:this._className,interfaceName:"wcf\\data\\ISortableAction",parameters:a});this._proxy.sendRequest()}});