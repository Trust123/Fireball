/*
    2013 - 2015 codeQuake
 @license    GNU Lesser General Public License <http://www.gnu.org/licenses/lgpl-3.0.txt>
 @package    de.codequake.cms
*/
var $jscomp={scope:{},findInternal:function(a,b,c){a instanceof String&&(a=String(a));for(var d=a.length,e=0;e<d;e++){var f=a[e];if(b.call(c,f,e,a))return{i:e,v:f}}return{i:-1,v:void 0}}};$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){if(c.get||c.set)throw new TypeError("ES3 does not support getters and setters.");a!=Array.prototype&&a!=Object.prototype&&(a[b]=c.value)};
$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);$jscomp.polyfill=function(a,b,c,d){if(b){c=$jscomp.global;a=a.split(".");for(d=0;d<a.length-1;d++){var e=a[d];e in c||(c[e]={});c=c[e]}a=a[a.length-1];d=c[a];b=b(d);b!=d&&null!=b&&$jscomp.defineProperty(c,a,{configurable:!0,writable:!0,value:b})}};
$jscomp.polyfill("Array.prototype.find",function(a){return a?a:function(a,c){return $jscomp.findInternal(this,a,c).v}},"es6-impl","es3");if(!Fireball)var Fireball={};
$.widget("ui.fireSlide",{_buttonList:null,_count:0,_index:0,_items:null,_itemContainer:null,_timer:null,options:{speed:2E3},_width:0,_create:function(){var a=this.element.children("div");this._itemContainer=$("<div />").appendTo(this.element).css("left",0);a.appendTo(this._itemContainer);this._items=this._itemContainer.children("div");this._count=this._items.length;a=this._index=0;this._width=this.element.innerWidth();this._items.each($.proxy(function(a,b){$(b).css({left:a*(40+this._width),width:this._width}).show()},
this));this._buttonList=$('<ul class="slideshowButtonList" />').appendTo(this.element);for(var b=0;b<this._count;b++){$(this._items.get(b)).outerHeight()>=a&&(a=$(this._items.get(b)).outerHeight());var c=$('<li><a><span class="icon icon16 fa-circle"></span></a></li>').click($.proxy(this._click,this)).appendTo(this._buttonList);0==b&&c.addClass("active")}this.element.css("height",a);$(window).resize($.proxy(this._resize,this));this._restartTimer()},_click:function(a){a.preventDefault();this.slideTo($(a.currentTarget).index());
this._restartTimer()},_resize:function(){for(var a=0,b=0;b<this._count;b++)$(this._items.get(b)).outerHeight()>=a&&(a=$(this._items.get(b)).outerHeight());this.element.css("height",a);this._width=this.element.innerWidth();this._items.each($.proxy(function(a,b){$(b).css({left:a*(40+this._width),width:this._width})},this));this._index=0;this.slideTo()},_restartTimer:function(){null!==this._timer&&window.clearInterval(this._timer);this._timer=window.setInterval($.proxy(this.slideTo,this),this.options.speed)},
slideTo:function(a){this._index="undefined"!==typeof a?a:this._index+1;this._index==this._count&&(this._index=0);this._buttonList.find(".active").removeClass("active");$(this._buttonList.children().get(this._index)).addClass("active");this._itemContainer.css({left:this._index*(40+this._width)*-1})}});Fireball.Page={};
Fireball.Page.Add=Class.extend({_pageID:0,_cache:{},_dialog:null,init:function(a){this._pageID=a;$("#pageAddButton").click($.proxy(this._click,this))},_click:function(a){a.preventDefault();this._proxy=new WCF.Action.Proxy({success:$.proxy(this._success,this)});this._proxy.setOption("data",{actionName:"getAddDialog",className:"cms\\data\\page\\PageAction",objectIDs:[this._pageID]});this._proxy.sendRequest()},_show:function(a){this._dialog=$('<div id="pageAddDialog">'+this._cache[a]+"</div>").appendTo(document.body);
this._dialog.wcfDialog({title:WCF.Language.get("cms.page.add")});this._dialog.find("input[type=submit]").click($.proxy(this._submit,this))},_submit:function(a){a.preventDefault();parameters={};$("#pageAddForm input, #pageAddForm textarea, #pageAddForm select").each(function(a){a=$(this);"checkbox"!=a.attr("type")?parameters[a.attr("name")]=$.trim(a.val()):parameters[a.attr("name")]=a.prop("checked")?1:0});this._proxy=new WCF.Action.Proxy({success:$.proxy(this._executed,this)});this._proxy.setOption("data",
{actionName:"frontendCreate",className:"cms\\data\\page\\PageAction",objectIDs:[this._pageID],parameters:{data:parameters}});this._proxy.sendRequest()},_executed:function(a,b,c){"undefined"===typeof this._cache[a.returnValues.errors]&&(new WCF.System.Notification(WCF.Language.get("wcf.global.success"))).show(function(){window.location=a.returnValues.link})},_success:function(a,b,c){this._cache[a.returnValues.pageID]=a.returnValues.template;this._show(a.returnValues.pageID)}});
Fireball.Page.ContentTypes=Class.extend({_pageID:0,_proxy:null,_initialized:0,_cache:{},init:function(a){this._pageID=a;this._proxy=new WCF.Action.Proxy({success:$.proxy(this._success,this)});this._proxy.setOption("data",{actionName:"getContentTypes",className:"cms\\data\\page\\PageAction",objectIDs:[this._pageID],parameters:{position:"both"}});this._proxy.sendRequest()},_success:function(a,b,c){this._cache[a.returnValues.pageID]=a.returnValues.template;$("body").append(a.returnValues.template);$("body").append($('<a id="contentTypeListOpen" class="button buttonPrimary"><span class="icon icon32 fa-angle-right"></span></a>'));
$("#contentTypeListOpen").click($.proxy(this._toggleSidebar,this));$("#contentTypeListClose").click($.proxy(this._toggleSidebar,this))},_toggleSidebar:function(a){a.preventDefault();$("#contentTypeList").hasClass("open")?$("#contentTypeList").removeClass("open"):(this._initialized||(new Fireball.Content.Dragging(this._pageID),this._initialized=1),$("#contentTypeList").addClass("open"));$("#contentTypeListOpen").toggle()}});Fireball.Content={};
Fireball.Content.Dragging=Class.extend({_pageID:0,init:function(a){this._pageID=a;$header=$(".content .contentHeader");a=$('<div class="sortableListContainer sortableContentList" id="sortableContentListBody" />').insertAfter($header);var b='<ol class="sortableList" data-object-id="0">',c=0;$("div[id^='cmsContent']").each(function(){var a=$(this).parents("div[id^='cmsContent']").length,b=$(this).children("div[id^='cmsContent']").length;$(this).addClass("ui-droppable").attr({"data-depth":a,"data-children":b}).prepend('<span class="sortableNodeLabel">'+
$(this).data("contentType")+"</span>")});$("div[id^='cmsContent']").each(function(){for(var a=$(this).data("depth"),d=0;d<c-a;d++)b+="</ol></li>";d=$(this);d.children("div[id^='cmsContent']").remove();b+='<li style="margin-top: 10px; padding-bottom: 10px;" class="sortableNode jsCollapsibleCategory ui-droppable '+$(this).attr("class")+'" id="'+$(this).attr("id")+'" data-object-id="'+$(this).attr("id").replace("cmsContent","")+'" data-depth="'+$(this).data("depth")+'">'+d.html()+'<ol class="sortableList" data-object-id="'+
$(this).attr("id").replace("cmsContent","")+'" style="margin-left: 5px; margin-right: 5px;">';0==$(this).data("children")&&(b+="</ol></li>");c=a;$(this).remove()});for(var d=0;d<c;d++)b+="</ol></li>";b+="</ol>";$(b).appendTo(a);new Fireball.Content.Sortable.List;$(".userNotice").after($('<div class="ui-droppable"></div>'));$(".draggable").draggable({cursor:"move",helper:"clone",revert:"invalid",containment:"document",drag:$.proxy(this._drag,this)});$(".ui-droppable").droppable({activeClass:"droppable-state-active",
greedy:!0,drop:$.proxy(this._drop,this)})},_drop:function(a,b){if("undefined"!==typeof b.draggable.attr("id")&&b.draggable.attr("id").match("^de.codequake.cms")){$(a.target).append('<div class="draggedContent '+b.draggable.attr("id")+'" />');var c=b.draggable.attr("id");if("undefined"!==typeof $(a.target).attr("id")&&$(a.target).attr("id").match("^cmsContent"))var d=$(a.target).attr("id").replace("cmsContent","");var e=0;"undefined"!==typeof d&&(e=d);new Fireball.Content.AddForm(this._pageID,"body",
c,e)}}});Fireball.Content.Sortable={};Fireball.Content.Sortable.List=WCF.Sortable.List.extend({init:function(){this._super("sortableContentListBody");$("#contentTypeList .wideButton").children('button[data-type="submit"]').click($.proxy(this._submit,this));this._className="cms\\data\\content\\ContentAction"},_success:function(a,b,c){this._super(a,b,c);window.location=location}});
Fireball.Content.AddForm=Class.extend({_pageID:0,_cache:{},_dialog:null,init:function(a,b,c,d){this._pageID=a;this._proxy=new WCF.Action.Proxy({success:$.proxy(this._success,this)});this._proxy.setOption("data",{actionName:"getAddDialog",className:"cms\\data\\content\\ContentAction",objectIDs:[],parameters:{position:b,type:c,parentID:d,pageID:this._pageID}});this._proxy.sendRequest()},_show:function(a){this._dialog=$('<div id="contentAddDialog">'+this._cache[a]+"</div>").appendTo(document.body);this._dialog.wcfDialog({title:WCF.Language.get("cms.content.add")});
this._dialog.find("input[type=submit]").click($.proxy(this._submit,this))},_executed:function(a,b,c){"undefined"===typeof a.returnValues.errors&&(this._dialog.wcfDialog("close"),(new WCF.System.Notification(WCF.Language.get("wcf.global.success"))).show(function(){window.location=location}))},_submit:function(a){a.preventDefault();parameters={contentData:{}};parameters.contentData.columnData=[];$("#contentAddForm input, #contentAddForm textarea, #pageAddForm select").each(function(a){a=$(this);"checkbox"!=
a.attr("type")?parameters[a.attr("name")]=$.trim(a.val()):parameters[a.attr("name")]=a.prop("checked")?1:0;"undefined"!==typeof a.attr("name")&&a.attr("name").match("^contentData")&&(delete parameters[a.attr("name")],0!=$("#contentAddForm .redactor-box").length&&$("#"+a.attr("id")).redactor("code.toggle"),a.attr("name").match("columnData")?parameters.contentData.columnData.push($.trim(a.val())):parameters.contentData[a.attr("id")]=$.trim(a.val()),"undefined"!==typeof parameters.contentData.columnData&&
0==parameters.contentData.columnData.length&&delete parameters.contentData.columnData)});console.log(parameters);this._proxy=new WCF.Action.Proxy({success:$.proxy(this._executed,this)});this._proxy.setOption("data",{actionName:"frontendCreate",className:"cms\\data\\content\\ContentAction",objectIDs:[],parameters:{data:parameters}});this._proxy.sendRequest()},_success:function(a,b,c){this._cache[this._pageID]=a.returnValues.template;this._show(this._pageID)}});
