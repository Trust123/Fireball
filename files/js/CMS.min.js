if(!CMS)var CMS={};$.widget("ui.fireSlide",{_buttonList:null,_count:0,_index:0,_items:null,_itemContainer:null,_timer:null,options:{speed:2e3},_width:0,_create:function(){var d=this.element.children("div");this._itemContainer=$("<div />").appendTo(this.element).css("left",0);d.appendTo(this._itemContainer);this._items=this._itemContainer.children("div");this._count=this._items.length;this._index=0;var b=0;this._width=this.element.innerWidth();this._items.each($.proxy(function(a,b){$(b).css({left:a*(40+this._width),width:this._width}).show()},this));this._buttonList=$('<ul class="slideshowButtonList" />').appendTo(this.element);for(var a=0;a<this._count;a++){if($(this._items.get(a)).outerHeight()>=b)b=$(this._items.get(a)).outerHeight();var c=$('<li><a><span class="icon icon16 icon-circle"></span></a></li>').click($.proxy(this._click,this)).appendTo(this._buttonList);a==0&&c.addClass("active")}this.element.css("height",b);$(window).resize($.proxy(this._resize,this));this._restartTimer()},_click:function(a){a.preventDefault();this.slideTo($(a.currentTarget).index());this._restartTimer()},_resize:function(){for(var b=0,a=0;a<this._count;a++)if($(this._items.get(a)).outerHeight()>=b)b=$(this._items.get(a)).outerHeight();this.element.css("height",b);this._width=this.element.innerWidth();this._items.each($.proxy(function(a,b){$(b).css({left:a*(40+this._width),width:this._width})},this));this._index=0;this.slideTo()},_restartTimer:function(){this._timer!==null&&window.clearInterval(this._timer);this._timer=window.setInterval($.proxy(this.slideTo,this),this.options.speed)},slideTo:function(a){if(typeof a!=="undefined")this._index=a;else this._index=this._index+1;if(this._index==this._count)this._index=0;this._buttonList.find(".active").removeClass("active");$(this._buttonList.children().get(this._index)).addClass("active");this._itemContainer.css({left:this._index*(40+this._width)*-1})}});CMS.Page={};CMS.Page.Add=Class.extend({_pageID:0,_cache:{},_dialog:null,init:function(a){this._pageID=a;$("#pageAddButton").click($.proxy(this._click,this))},_click:function(a){a.preventDefault();this._proxy=new WCF.Action.Proxy({success:$.proxy(this._success,this)});this._proxy.setOption("data",{actionName:"getAddDialog",className:"cms\\data\\page\\PageAction",objectIDs:[this._pageID]});this._proxy.sendRequest()},_show:function(a){this._dialog=$('<div id="pageAddDialog">'+this._cache[a]+"</div>").appendTo(document.body);this._dialog.wcfDialog({title:WCF.Language.get("cms.page.add")});this._dialog.find("input[type=submit]").click($.proxy(this._submit,this))},_submit:function(a){a.preventDefault();parameters={};$("#pageAddForm input, #pageAddForm textarea, #pageAddForm select").each(function(){var a=$(this);if(a.attr("type")!="checkbox")parameters[a.attr("name")]=$.trim(a.val());else parameters[a.attr("name")]=a.prop("checked")?1:0});this._proxy=new WCF.Action.Proxy({success:$.proxy(this._executed,this)});this._proxy.setOption("data",{actionName:"frontendCreate",className:"cms\\data\\page\\PageAction",objectIDs:[this._pageID],parameters:{data:parameters}});this._proxy.sendRequest()},_executed:function(a){if(typeof this._cache[a.returnValues.errors]==="undefined"){var b=new WCF.System.Notification(WCF.Language.get("wcf.global.success"));b.show(function(){window.location=a.returnValues.link})}},_success:function(a){this._cache[a.returnValues.pageID]=a.returnValues.template;this._show(a.returnValues.pageID)}});CMS.Page.ContentTypes=Class.extend({_pageID:0,_proxy:null,_initialized:0,_cache:{},init:function(a){this._pageID=a;this._proxy=new WCF.Action.Proxy({success:$.proxy(this._success,this)});this._proxy.setOption("data",{actionName:"getContentTypes",className:"cms\\data\\page\\PageAction",objectIDs:[this._pageID],parameters:{position:"both"}});this._proxy.sendRequest();$("body").append($('<a id="contentAddButton"><span class="icon icon16 icon-chevron-right"></span></a>'));$("body").append($('<div id="contentRibbon" />'));$("#contentAddButton").click($.proxy(this._openSidebar,this))},_success:function(a){this._cache[a.returnValues.pageID]=a.returnValues.template;$("#contentRibbon").append(a.returnValues.template)},_openSidebar:function(a){a.preventDefault();if(!$("#contentRibbon").hasClass("open")){if(!this._initialized){new CMS.Content.Dragging(this._pageID);this._initialized=1}$("#contentRibbon").addClass("open");$("#contentAddButton").addClass("open").children("span").addClass("icon-chevron-left").removeClass("icon-chevron-right");$("body").addClass("ribbonOpen")}else{$("#contentRibbon").removeClass("open");$("#contentAddButton").removeClass("open").children("span").removeClass("icon-chevron-left").addClass("icon-chevron-right");$("body").removeClass("ribbonOpen")}}});CMS.Content={};CMS.Content.Dragging=Class.extend({_pageID:0,init:function(f){this._pageID=f;var d='<div class="ui-droppable"></div>',e=$('<div class="sortableListContainer sortableContentList" id="sortableContentListBody" />').insertAfter($(".userNotice")),a='<ol class="sortableList" data-object-id="0">',b=0;$("div[id^='cmsContent']").each(function(){var b=$(this).parents("div[id^='cmsContent']").length,a=$(this).children("div[id^='cmsContent']").length;$(this).addClass("ui-droppable").attr({"data-depth":b,"data-children":a}).prepend('<span class="sortableNodeLabel">'+$(this).data("contentType")+"</span>")});$("div[id^='cmsContent']").each(function(){for(var d=$(this).data("depth"),e=0;e<b-d;e++)a+="</ol></li>";var c=$(this);c.children("div[id^='cmsContent']").remove();a+='<li style="margin-top: 10px; padding-bottom: 10px;" class="sortableNode jsCollapsibleCategory ui-droppable '+$(this).attr("class")+'" id="'+$(this).attr("id")+'" data-object-id="'+$(this).attr("id").replace("cmsContent","")+'" data-depth="'+$(this).data("depth")+'">'+c.html()+'<ol class="sortableList" data-object-id="'+$(this).attr("id").replace("cmsContent","")+'" style="margin-left: 5px; margin-right: 5px;">';if($(this).data("children")==0)a+="</ol></li>";b=d;$(this).remove()});for(var c=0;c<b;c++)a+="</ol></li>";a+="</ol>";$(a).appendTo(e);new CMS.Content.Sortable.List;$(".userNotice").after($(d));$(".draggable").draggable({cursor:"move",helper:"clone",revert:"invalid",containment:"document",drag:$.proxy(this._drag,this)});$(".ui-droppable").droppable({activeClass:"droppable-state-active",greedy:true,drop:$.proxy(this._drop,this)})},_drop:function(a,b){if(typeof b.draggable.attr("id")!=="undefined"&&b.draggable.attr("id").match("^de.codequake.cms")){$(a.target).append('<div class="draggedContent '+b.draggable.attr("id")+'" />');var f=b.draggable.attr("id"),e="body";if(typeof $(a.target).attr("id")!=="undefined"&&$(a.target).attr("id").match("^cmsContent"))var d=$(a.target).attr("id").replace("cmsContent","");var c=0;if(typeof d!=="undefined")c=d;new CMS.Content.AddForm(this._pageID,e,f,c)}}}),CMS.Content.Sortable={};CMS.Content.Sortable.List=WCF.Sortable.List.extend({init:function(){this._super("sortableContentListBody");$("#contentRibbon .wideButton").children('button[data-type="submit"]').click($.proxy(this._submit,this));this._className="cms\\data\\content\\ContentAction"},_success:function(c,a,b){this._super(c,a,b);window.location=location}});CMS.Content.AddForm=Class.extend({_pageID:0,_cache:{},_dialog:null,init:function(c,b,d,a){this._pageID=c;this._proxy=new WCF.Action.Proxy({success:$.proxy(this._success,this)});this._proxy.setOption("data",{actionName:"getAddDialog",className:"cms\\data\\content\\ContentAction",objectIDs:[],parameters:{position:b,type:d,parentID:a,pageID:this._pageID}});this._proxy.sendRequest()},_show:function(a){this._dialog=$('<div id="contentAddDialog">'+this._cache[a]+"</div>").appendTo(document.body);this._dialog.wcfDialog({title:WCF.Language.get("cms.content.add")});this._dialog.find("input[type=submit]").click($.proxy(this._submit,this))},_executed:function(b){if(typeof b.returnValues.errors==="undefined"){this._dialog.wcfDialog("close");var a=new WCF.System.Notification(WCF.Language.get("wcf.global.success"));a.show(function(){window.location=location})}},_submit:function(a){a.preventDefault();parameters={};parameters.contentData={};parameters.contentData.columnData=[];$("#contentAddForm input, #contentAddForm textarea, #pageAddForm select").each(function(){var a=$(this);if(a.attr("type")!="checkbox")parameters[a.attr("name")]=$.trim(a.val());else parameters[a.attr("name")]=a.prop("checked")?1:0;if(typeof a.attr("name")!=="undefined"&&a.attr("name").match("^contentData")){delete parameters[a.attr("name")];$("#contentAddForm .redactor-box").length!=0&&$("#"+a.attr("id")).redactor("code.toggle");if(a.attr("name").match("columnData"))parameters.contentData.columnData.push($.trim(a.val()));else parameters.contentData[a.attr("id")]=$.trim(a.val());if(typeof parameters.contentData.columnData!=="undefined"&&parameters.contentData.columnData.length==0)delete parameters.contentData.columnData}});console.log(parameters);this._proxy=new WCF.Action.Proxy({success:$.proxy(this._executed,this)});this._proxy.setOption("data",{actionName:"frontendCreate",className:"cms\\data\\content\\ContentAction",objectIDs:[],parameters:{data:parameters}});this._proxy.sendRequest()},_success:function(a){this._cache[this._pageID]=a.returnValues.template;this._show(this._pageID)}})
