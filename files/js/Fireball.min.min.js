$.widget("ui.fireSlide",{_buttonList:null,_count:0,_index:0,_items:null,_itemContainer:null,_timer:null,options:{speed:2000},_width:0,_create:function(){var e=this.element.children("div");this._itemContainer=$("<div />").appendTo(this.element).css("left",0);e.appendTo(this._itemContainer);this._items=this._itemContainer.children("div");this._count=this._items.length;this._index=0;var h=0;this._width=this.element.innerWidth();this._items.each($.proxy(function(b,a){$(a).css({left:(b*(40+this._width)),width:this._width}).show()},this));this._buttonList=$('<ul class="slideshowButtonList" />').appendTo(this.element);for(var g=0;g<this._count;g++){if($(this._items.get(g)).outerHeight()>=h){h=$(this._items.get(g)).outerHeight()}var f=$('<li><a><span class="icon icon16 fa-circle"></span></a></li>').click($.proxy(this._click,this)).appendTo(this._buttonList);if(g==0){f.addClass("active")}}this.element.css("height",h);$(window).resize($.proxy(this._resize,this));this._restartTimer()},_click:function(b){b.preventDefault();this.slideTo($(b.currentTarget).index());this._restartTimer()},_resize:function(){var d=0;for(var c=0;c<this._count;c++){if($(this._items.get(c)).outerHeight()>=d){d=$(this._items.get(c)).outerHeight()}}this.element.css("height",d);this._width=this.element.innerWidth();this._items.each($.proxy(function(b,a){$(a).css({left:(b*(40+this._width)),width:this._width})},this));this._index=0;this.slideTo()},_restartTimer:function(){if(this._timer!==null){window.clearInterval(this._timer)}this._timer=window.setInterval($.proxy(this.slideTo,this),this.options.speed)},slideTo:function(b){if(typeof b!=="undefined"){this._index=b}else{this._index=this._index+1}if(this._index==this._count){this._index=0}this._buttonList.find(".active").removeClass("active");$(this._buttonList.children().get(this._index)).addClass("active");this._itemContainer.css({left:(this._index*(40+this._width)*-1)})}});if(!Fireball){var Fireball={}}Fireball.Page={};Fireball.Page.Add=Class.extend({_pageID:0,_cache:{},_dialog:null,init:function(b){this._pageID=b;$("#pageAddButton").click($.proxy(this._click,this))},_click:function(b){b.preventDefault();this._proxy=new WCF.Action.Proxy({success:$.proxy(this._success,this)});this._proxy.setOption("data",{actionName:"getAddDialog",className:"cms\\data\\page\\PageAction",objectIDs:[this._pageID]});this._proxy.sendRequest()},_show:function(b){this._dialog=$('<div id="pageAddDialog">'+this._cache[b]+"</div>").appendTo(document.body);this._dialog.wcfDialog({title:WCF.Language.get("cms.page.add")});this._dialog.find("input[type=submit]").click($.proxy(this._submit,this))},_submit:function(b){b.preventDefault();parameters={};$("#pageAddForm input, #pageAddForm textarea, #pageAddForm select").each(function(d){var a=$(this);if(a.attr("type")!="checkbox"){parameters[a.attr("name")]=$.trim(a.val())}else{parameters[a.attr("name")]=a.prop("checked")?1:0}});this._proxy=new WCF.Action.Proxy({success:$.proxy(this._executed,this)});this._proxy.setOption("data",{actionName:"frontendCreate",className:"cms\\data\\page\\PageAction",objectIDs:[this._pageID],parameters:{data:parameters}});this._proxy.sendRequest()},_executed:function(e,g,f){if(typeof this._cache[e.returnValues.errors]==="undefined"){var h=new WCF.System.Notification(WCF.Language.get("wcf.global.success"));h.show(function(){window.location=e.returnValues.link})}},_success:function(d,f,e){this._cache[d.returnValues.pageID]=d.returnValues.template;this._show(d.returnValues.pageID)}});Fireball.Page.ContentTypes=Class.extend({_pageID:0,_proxy:null,_setDraggable:false,init:function(b){this._pageID=b;this._proxy=new WCF.Action.Proxy({success:$.proxy(this._success,this)});this._proxy.setOption("data",{actionName:"getContentTypes",className:"cms\\data\\page\\PageAction",objectIDs:[this._pageID],parameters:{position:"both"}});this._proxy.sendRequest()},setSet:function(){this._setDraggable=true},_success:function(d,f,e){$("body").append(d.returnValues.template)},_toggleSidebar:function(){if(!$("#contentTypeList").hasClass("open")){$("#contentTypeList").addClass("open")}else{this._closeSidebar()}},_closeSidebar:function(){if($("#contentTypeList").hasClass("open")){$("#contentTypeList").removeClass("open")}}});Fireball.Page.InlineEditor=WCF.InlineEditor.extend({_pageID:0,_environment:"page",_permissions:{},_redirectURL:"",_updateHandler:null,_editStarted:false,_contentTypeOverlay:null,_dragging:null,_proxy:null,_setOptions:function(){this._environment="page";this._options=[{label:WCF.Language.get("cms.page.edit.start"),optionName:"start"},{label:WCF.Language.get("cms.page.edit.addContent"),optionName:"addContent"},{label:WCF.Language.get("cms.page.edit.save"),optionName:"save"},{optionName:"divider"},{label:WCF.Language.get("cms.page.edit.finish"),optionName:"finish"},{label:WCF.Language.get("cms.page.edit.acp"),optionName:"acp",isQuickOption:true}]},setUpdateHandler:function(b){this._updateHandler=b},_getTriggerElement:function(b){return b.find(".jsPageInlineEditor")},_validate:function(d,c){switch(c){case"addContent":return this._editStarted;break;case"start":return !this._editStarted;break;case"save":return this._editStarted;break;case"finish":return this._editStarted;break;case"acp":return true;break}return false},_execute:function(e,f){if(!this._validate(e,f)){return false}switch(f){case"start":if(this._editStarted){return}var d=this;this._contentTypeOverlay=new Fireball.Page.ContentTypes(this._pageID);this._dragging=new Fireball.Content.Dragging(this._pageID);this._editStarted=true;break;case"addContent":this._contentTypeOverlay._toggleSidebar();if(!this._contentTypeOverlay._setDraggable){$(".draggable").draggable({cursor:"move",helper:"clone",revert:"invalid",containment:"document",drag:$.proxy(this._dragging._drag,this._dragging)})}break;case"save":this._dragging.getSortableListObject("body")._submit();this._dragging.getSortableListObject("sidebar")._submit();break;case"finish":var d=this;WCF.System.Confirmation.show(WCF.Language.get("cms.page.edit.finish.confirm"),function(a){if(a==="confirm"){d._contentTypeOverlay._closeSidebar();this._proxy=new WCF.Action.Proxy({success:$.proxy(d._loadParsedContents,d)});this._proxy.setOption("data",{actionName:"getParsedContentList",className:"cms\\data\\page\\PageAction",objectIDs:[d._pageID],parameters:{position:"body"}});this._proxy.sendRequest();this._proxy.setOption("data",{actionName:"getParsedContentList",className:"cms\\data\\page\\PageAction",objectIDs:[d._pageID],parameters:{position:"sidebar"}});this._proxy.sendRequest();d._editStarted=false}});break;case"acp":window.location=$("#"+e).data("advancedUrl");break}},_loadParsedContents:function(d,f,e){position=d.returnValues.position;$('.ui-droppable[data-position="'+position+'"]').remove();$("#sortableContentList"+position.charAt(0).toUpperCase()+position.slice(1)).remove();if(d.returnValues.position=="body"){$(d.returnValues.template).insertAfter($(".content .contentHeader"))}else{if(d.returnValues.position=="sidebar"){$("aside.sidebar").append(d.returnValues.template)}else{if(d.returnValues.position=="sidebarLeft"){$("aside.boxesSidebarLeft").append(d.returnValues.template)}else{if(d.returnValues.position=="sidebarRight"){$("aside.boxesSidebarRight").append(d.returnValues.template)}}}}},_updatePage:function(g,i,h){var f=this;var j=this._elements[g].data("pageID");this._updateData.push({data:h,elementID:g,optionName:i});this._proxy.setOption("data",{actionName:i,className:"cms\\data\\page\\PageAction",objectIDs:[this._elements[g].data("pageID")],parameters:{data:h},success:function(a){f._updateHandler.update(j,a.returnValues.pageData[j])}});this._proxy.sendRequest()},_getPermission:function(b){if(this._permissions[b]){return this._permissions[b]}return 0},setEnvironment:function(e,d,f){if(e!=="page"){e="page"}this._environment=e;this._pageID=d;this._redirectURL=f},setPermission:function(d,c){this._permissions[d]=c},setPermissions:function(d){for(var c in d){this.setPermission(c,d[c])}}});Fireball.Page.UpdateHandler=Class.extend({});Fireball.Content={};Fireball.Content.AddForm=Class.extend({_pageID:0,_cache:{},_dialog:null,init:function(e,f,h,g){this._pageID=e;this._proxy=new WCF.Action.Proxy({success:$.proxy(this._success,this)});this._proxy.setOption("data",{actionName:"getAddDialog",className:"cms\\data\\content\\ContentAction",objectIDs:[],parameters:{position:f,type:h,parentID:g,pageID:this._pageID}});this._proxy.sendRequest()},_show:function(b){this._dialog=$('<div id="contentAddDialog">'+this._cache[b]+"</div>").appendTo(document.body);this._dialog.wcfDialog({title:WCF.Language.get("cms.content.add")});this._dialog.find("input[type=submit]").click($.proxy(this._submit,this))},_executed:function(e,g,f){if(typeof e.returnValues.errors==="undefined"){this._dialog.wcfDialog("close");var h=new WCF.System.Notification(WCF.Language.get("wcf.global.success"));h.show(function(){window.location=location})}},_submit:function(b){b.preventDefault();parameters={};parameters.contentData={};parameters.contentData.columnData=[];$("#contentAddForm input, #contentAddForm textarea, #contentAddForm select").each(function(d){var a=$(this);if(a.attr("type")!="checkbox"){parameters[a.attr("name")]=$.trim(a.val())}else{parameters[a.attr("name")]=a.prop("checked")?1:0}if(typeof a.attr("name")!=="undefined"&&a.attr("name").match("^contentData")){delete parameters[a.attr("name")];if(a.attr("name").match("columnData")){parameters.contentData.columnData.push($.trim(a.val()))}else{parameters.contentData[a.attr("id")]=$.trim(a.val())}if(typeof parameters.contentData.columnData!=="undefined"&&parameters.contentData.columnData.length==0){delete parameters.contentData.columnData}}});this._proxy=new WCF.Action.Proxy({success:$.proxy(this._executed,this)});this._proxy.setOption("data",{actionName:"frontendCreate",className:"cms\\data\\content\\ContentAction",objectIDs:[],parameters:{data:parameters}});this._proxy.sendRequest()},_success:function(d,f,e){this._cache[this._pageID]=d.returnValues.template;this._show(this._pageID)}});Fireball.Content.Dragging=Class.extend({_sortableList:{},_proxy:null,_pageID:0,init:function(b){this._pageID=b;$("div[id^='cmsContent']").each(function(){$(this).remove()});$("section[id^='cmsContent']").each(function(){$(this).remove()});this._proxy=new WCF.Action.Proxy({success:$.proxy(this._success,this)});this._proxy.setOption("data",{actionName:"getSortableContentList",className:"cms\\data\\page\\PageAction",objectIDs:[this._pageID],parameters:{position:"body"}});this._proxy.sendRequest();this._proxy.setOption("data",{actionName:"getSortableContentList",className:"cms\\data\\page\\PageAction",objectIDs:[this._pageID],parameters:{position:"sidebar"}});this._proxy.sendRequest()},_drag:function(d,c){c.helper.css("position","fixed");c.helper.css("margin-top",d.pageY);c.helper.css("margin-left",d.pageX);c.position.top=0;c.position.left=0},_drop:function(l,j){if(typeof j.draggable.attr("id")!=="undefined"&&j.draggable.attr("id").match("^de.codequake.cms")){$(l.target).append('<div class="draggedContent '+j.draggable.attr("id")+'" />');var g=j.draggable.attr("id");var h="body";if(typeof $(l.target).data("position")!=="undefined"){h=$(l.target).data("position")}if(typeof $(l.target).attr("id")!=="undefined"&&$(l.target).attr("id").match("^cmsContent")){var k=$(l.target).attr("id").replace("cmsContent","")}var i=0;if(typeof k!=="undefined"){i=k}new Fireball.Content.AddForm(this._pageID,h,g,i)}},_success:function(d,f,e){template=d.returnValues.template;if(d.returnValues.position=="body"){$(template).insertAfter($(".content .contentHeader"))}else{if(d.returnValues.position=="sidebar"){$("aside.sidebar").append(template)}else{if(d.returnValues.position=="sidebarLeft"){$("aside.boxesSidebarLeft").append(template)}else{if(d.returnValues.position=="sidebarRight"){$("aside.boxesSidebarRight").append(template)}}}}$container=$("#sortableContentList"+d.returnValues.position.charAt(0).toUpperCase()+d.returnValues.position.slice(1));this._sortableList[d.returnValues.position]=new Fireball.Content.Sortable.List("sortableContentList"+d.returnValues.position.charAt(0).toUpperCase()+d.returnValues.position.slice(1));if($container!==undefined){$container.parent().find(".ui-droppable").droppable({activeClass:"droppable-state-active",greedy:true,drop:$.proxy(this._drop,this)})}},getSortableListObject:function(b){return this._sortableList[b]}});Fireball.Content.Sortable={};Fireball.Content.Sortable.List=WCF.Sortable.List.extend({init:function(b){this._super(b);this._className="cms\\data\\content\\ContentAction"},_submit:function(){this._structure={};this._container.find(".sortableList").each($.proxy(function(h,f){var a=$(f);var g=a.data("objectID");if(g!==undefined){a.children(this._options.items).each($.proxy(function(e,c){var d=$(c).data("objectID");if(!this._structure[g]){this._structure[g]=[]}this._structure[g].push(d)},this))}},this));if(Object.keys(this._structure).length===0){return}var b=$.extend(true,{data:{offset:this._offset,structure:this._structure}},this._additionalParameters);this._proxy.setOption("data",{actionName:"updatePosition",className:this._className,interfaceName:"wcf\\data\\ISortableAction",parameters:b});this._proxy.sendRequest()}});